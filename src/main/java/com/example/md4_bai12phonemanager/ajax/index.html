<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Smartphone Manager</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<form id="add-smartphone" onsubmit="createSmartphone(); return false;" style="display: none;">
    <h1>Form Create</h1>
    <table>
        <tr>
            <td><label for="producer">Producer:</label></td>
            <td><input type="text" id="producer" placeholder="producer"></td>
        </tr>
        <tr>
            <td><label for="model">Model:</label></td>
            <td><input type="text" id="model" placeholder="model"></td>
        </tr>
        <tr>
            <td><label for="price">Price:</label></td>
            <td><input type="text" id="price" placeholder="price"></td>
        </tr>
        <tr>
            <td></td>
            <td><input type="submit" value="Add"></td>
        </tr>
    </table>
</form>

<div id="edit-smartphone-section" style="display: none;"></div>

<h1 id="title">List of Smartphones</h1>
<div id="div-btn">
    <button onclick="refreshSmartphoneList()" id="display">Display list smartphone</button>
    <button onclick="showFormCreate()" id="display-create">Create new smartphone</button>
</div>
<div id="smartphone-container"></div>

<script>
    function createSmartphone() {
        event.preventDefault();
        let producer = document.getElementById("producer").value;
        let model = document.getElementById("model").value;
        let price = document.getElementById("price").value;
        let newSmartphone = {
            "producer": producer,
            "model": model,
            "price": price
        };
        $.ajax({
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            type: "POST",
            data: JSON.stringify(newSmartphone),
            url: "http://localhost:8080/api/smartphones",
            success: refreshSmartphoneList
        });
    }

    function refreshSmartphoneList() {
        $.ajax({
            type: "GET",
            url: "http://localhost:8080/api/smartphones",
            success: function (data) {
                let content = '<table id="smartphone-table" border="1"><tr>' +
                    '<th>Producer</th>' +
                    '<th>Model</th>' +
                    '<th>Price</th>' +
                    '<th>Delete</th>' +
                    '<th>Edit</th>' +
                    '</tr>';
                data.forEach(smartphone => {
                    content += renderSmartphoneRow(smartphone);
                });
                content += "</table>";
                document.getElementById('smartphone-container').innerHTML = content;
                document.getElementById('smartphone-container').style.display = "block";
                document.getElementById('add-smartphone').style.display = "none";
                document.getElementById('edit-smartphone-section').style.display = "none";
            }
        });
    }

    function renderSmartphoneRow(smartphone) {
        return `<tr>
                    <td>${smartphone.producer}</td>
                    <td>${smartphone.model}</td>
                    <td>${smartphone.price}</td>
                    <td><button type="button" class="delete-btn" onclick="removeSmartphone(${smartphone.id})">Delete</button></td>
                    <td><button type="button" class="edit-btn" onclick="showEditForm(${smartphone.id})">Edit</button></td>
                </tr>`;
    }

    function showFormCreate() {
        document.getElementById('smartphone-container').style.display = "none";
        document.getElementById('add-smartphone').style.display = "block";
        document.getElementById('edit-smartphone-section').style.display = "none";
    }

    function removeSmartphone(id) {
        $.ajax({
            type: "DELETE",
            url: `http://localhost:8080/api/smartphones/${id}`,
            success: refreshSmartphoneList
        });
    }

    function renderEditForm(smartphone) {
        return `<tr>
                    <td><label for="producer-edit">Producer:</label></td>
                    <td><input type="text" id="producer-edit" value="${smartphone.producer}"></td>
                </tr>
                <tr>
                    <td><label for="model-edit">Model:</label></td>
                    <td><input type="text" id="model-edit" value="${smartphone.model}"></td>
                </tr>
                <tr>
                    <td><label for="price-edit">Price:</label></td>
                    <td><input type="text" id="price-edit" value="${smartphone.price}"></td>
                </tr>
                <tr>
                    <td></td>
                    <td><input type="submit" value="Save" onclick="updateSmartphone(${smartphone.id})"></td>
                </tr>`;
    }

    function showEditForm(id) {
        $.ajax({
            type: "GET",
            url: `http://localhost:8080/api/smartphones/${id}`,
            success: function (data) {
                let content = '<form id="edit-smartphone" onsubmit="updateSmartphone(' + id + '); return false;">' +
                    '<h1>Edit Smartphone</h1>' +
                    '<table>';
                content += renderEditForm(data);
                content += '</table></form>';
                document.getElementById('edit-smartphone-section').innerHTML = content;
                document.getElementById('smartphone-container').style.display = "none";
                document.getElementById('add-smartphone').style.display = "none";
                document.getElementById('edit-smartphone-section').style.display = "block";
            }
        });
    }

    function updateSmartphone(id) {
        event.preventDefault();
        let producer = document.getElementById("producer-edit").value;
        let model = document.getElementById("model-edit").value;
        let price = document.getElementById("price-edit").value;
        let updatedSmartphone = {
            "producer": producer,
            "model": model,
            "price": price
        };
        $.ajax({
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            type: "PUT",
            data: JSON.stringify(updatedSmartphone),
            url: `http://localhost:8080/api/smartphones/${id}`,
            success: refreshSmartphoneList
        });
    }
</script>
</body>
</html>
